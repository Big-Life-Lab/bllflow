---
title: "Helper and utility functions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Healper and utility functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  % \VignetteDepends{survival}
  % \VignetteDepends{dplyr}
  % \VignetteDepends{magrittr}
  
---

## Introduction

### Metadata

_bllFlow_ supports metadata from DDI and from the R packages hmisc and rjlabelled.

#### DDI metadata
The [Data Documentation Intitiatve](https://www.ddialliance.org) (DDI) is is an 
international standard for describing the data produced by surveys and other 
observational methods in the social, behavioral, economic, and health sciences.

```
Get the description of the study data from DDI and add the description to 
bllFlow object

```{r}
library(survival)
data(pbc)
library(bllFlow)

ddiPath <- 'file.path(getwd())'
ddiFile <-  'cchs-82M0013-E-2013-2014-Annual-component.xml'

pbcModel <- BLLFlow(pbc, getDDI = c(ddiPath, ddiFile, "description"))
# this function call would get all the info from DDI sections: docDscr, stdyDscr, fileDscr
# and add that info to the BLLFlow object.
# would invoke the 'addDDItoBLLFlow' function with attribute 'getDDIDescription = TRUE' (see below)

```
Get the varialbe metadata for the study data from DDI and add that the bllFlow 
object.

```{r}
variablesSheet <- read.csv(file.path(getwd(), '../inst/extdata/PBC/PBC - variables.csv'))
variableDetailsSheet <- read.csv(file.path(getwd(), '../inst/extdata/PBC/PBC - variable_details.csv'))
pbcModel <- BLLFlow(pbc, variablesSheet, variableDetailsSheet, getDDI = c(ddiPath, ddiFile, 
"variables"))
# this function call would bet just the DDI variable information and add that info
# to the BLLflow object
# would invoke the 'addDDItoBLLFlow' function with attribute 'getDDIVariables = TRUE' (see below)
```

Add both study data description and variable metadata.
```{r}
pbcModel <- BLLFlow(pbc, variablesSheet, variableDetailsSheet, getDDI = c(ddiPath, ddiFile))
# the same as calling both functions above.
# would invoke the 'addDDItoBLLFlow' function with attributes 'getDDIvariables = TRUE, 
# 'getDDIdescription = TRUE' (see below)
```

# General utily functions 
(These functions could already be in DDIwR?). Four functions.

getDDIdescription(DDIPath = ddiPath, DDIFile = ddiFile)
# same as calling BLLFlow(pbc, getDDI = c(ddiPath, ddiFile, "description"), but 
would not add the info to the bllFlow object.


getDDIvariables((DDIPath = ddiPath, DDIFile = ddiFile, variable = c(variableList))

addDDItoBLLFlow(bllFlowObject, getDDIDescription = TRUE, getDDIVariable = TRUE)

adddDDItoMSW(variableDetailsSheet, ddiPath, ddiFile)
