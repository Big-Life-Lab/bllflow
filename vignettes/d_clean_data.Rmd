---
title: "3 - Data cleaning and variable transformation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{3 - Data cleaning and variable transformation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
# Introduction
In _bllflow_ data cleaning is loosely defined as modifying rows (observations) and variable transformation as modifying columns (variables). Data preparation refers to both these procedures. Data preparation functions come in two forms:

1) Functions -- where the data and variables are specified as attributes within the function. _bllflow_ adds to functions that already exist in the `sjmisc` package.
2) _bllflow_ object functions -- where the Model Specification Workbook specifies which data is cleaned and which variables are transformed. These _bllflow_ 'wrapper' functions are available for selected functions in the `sjmisc` package and for all _bllflow_ objects. 

The effects of all data preparation functions can be logged and printed. Transformations can be saved as a Predictive Model Markup Language (PMML) file to faciliate predictive model deployment. 

## Data cleaning
Three data cleaning functions are supported. 

For continuous variables:

1) `clean.Min()` -- deletes observations below a defined value.
1) `clean.Max()` -- deletes observations above a defined value.

For categorical variables: 
1) `recodeWithTable()` TODO.

### Example 1: `clean.Max` and `clean.Min` as a generic utility function.
use clean.Min and clean.max without BLLFlow.

```{r}
# change current clean.Max() to be a generic function (then create a BBLFlow wrapper -- see below)
# TODO: clean.Min <- function(data, ..., min, print = FALSE) {}
# TODO: BBLClean.Min <- function(modelToClean, print = FALSE) {}

library(survival)
data(pbc)
library(bllflow)

# Todo: cleanedPbc <- clean.Min(pbc, age, 40)
```

### Example 2: `clean.Max` and `clean.Min` using BLLFlow model (and MSW variableDetails)
```{r}
variables <- read.csv(file.path(getwd(), '../inst/extdata/PBC-variables.csv'))
variableDetails <- read.csv(file.path(getwd(), '../inst/extdata/PBC-variableDetails.csv'))
pbcModel <- BLLFlow(pbc, variables, variableDetails)

# TODO: cleanedPbcModel <- clean.Max(pbc, age, 70, print = TRUE)
#print(cleanedPbcModel$metaData$log)
# TODO: cleanedPbcModel <- clean.Min(pbc, age, 40, print = TRUE)
#print(cleanedPbcModel$metaData$log)

```
##### original code below
```{r}
cleanedPbcModel <- clean.Max(pbcModel, print = TRUE)
cleanedPbcModel <- clean.Min(cleanedPbcModel, print = TRUE)

cleanedPbcModel$metaData$log # to print the entire log.
```

## Data tranformation

Supported functions: <font color="red">TODO</font>: describe these functions.
- centring
- normalization and standardization
- restrictive cubic splines
- interaction terms
- dummy variables
- recoding

## Logging

## Transformations to PMML
