---
title: "1 - Specifying your model"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{1 - Specifying your model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
## Introduction
The Model Specification Workbook (MSW) is used to specify your model. The MSW is 
a series of four worksheets (CSV files) that describe different model components. 
You can use **bllflow** without a MSW but we recommend using the 
`variables` and `variable_details` worksheets. 
 
## The four MSW worksheets

- **variables.csv** - Each row in the `variables.csv` file is a variable in your model. 
The columns include variable labels, type, and other information such as which 
variables are transformed (centered, have dummy variables, restrictive cubic 
splines, have interaction terms, etc.).
- **variablesCetails.csv** - includes the details of each variable, including all 
category (factor) levels and labels. Also included are  specific variable transformation 
rules.
- **modelCescription.csv** - includes information such as the model name, outcome, 
model, creator(s), date and data set names.
- **tableCescription.csv** - includes specifications for how to create Table 1 
and other tables.

## Getting stated with the Model Specification Worksheets.

You have your study data. Great. The first step is specifying which variables you 
need in your model as well as variables for study cohort creation, data cleaning and variable transformation. 

_bllflow_ has example Model Specification Work sheets for the `pbc` data and the 
vignette shows how to recreate a survival model for [primary biliary cirrhosis](https://aasldpubs.onlinelibrary.wiley.com/doi/pdf/10.1002/hep.1840100102). However, the specific work for many model types. 

## Examples of the Model Specification Worksheet
```{r} 
library(DT)

dt <- read.csv(system.file("extdata", "PBC/PBC-variables.csv", package = "bllFlow"))
datatable(dt, options = list(pageLength = 5))
```

## Importing the MSW worksheets
```{r}
library(survival)
data(pbc) # pbc survival data

# Read variables and variableDetails sheet for the PBC model
variablesSheet <- read.csv(file.path(getwd(), 'bllFlow/extdata/PBC/PBC-variables.csv'))
variableDetailsSheet <- read.csv(file.path(getwd(), 'bllFlow/extdata/PBC/PBC-variable-details.csv'))

```
```{r}
# Create a bllFlow R object for the PBC model using the above variables as args
library(bllFlow)
#' pbcModel <- BLLFlow(pbc, variablesSheet, variableDetailsSheet)

```

**bllFlow** also supports the use of DDI documents. If available, bllFlow labels 
and other information to the `variables.csv` and `variablesCetails.csv`, as well
as perserving data information to support data provenance. 




